const express = require("express");
const path = require("path");
const hbs = require("hbs");
const User = require('./models/usermessage');
const Preference = require("./models/preference");
require("./db/conn");
 
const port = process.env.PORT || 3000;

const app = express();

app.use(express.json()); 
app.use(express.urlencoded({extended : false}))

const templatePath = path.join(__dirname , "../templates/views");
const partialsPath = path.join(__dirname , "../templates/partials");
const staticPath = path.join(__dirname , "../public");  

app.use(express.static(staticPath));
app.set("views" , templatePath);
app.set("view engine" , "hbs");

hbs.registerPartials(partialsPath);

app.get("/" , (req,res) => {
    res.render("index");
});

app.get("/about" , (req,res) => {
    res.render("about");
});
app.get("/contact" , (req,res) => {
    res.render("contact");
});

app.get("/preference" , (req,res) => {
    res.render("preference");
});

app.post("/contact" , async (req,res) => {
    try{
     
        const userData = new User(req.body);
        await userData.save();
        res.status(201).render("index");

    }catch(err){
        res.status(400).send(err);
    };
});

app.post("/preference" , async (req,res) => {
    try{
        
        const prefData = new Preference(req.body);
        await prefData.save();
        res.status(201).render("index");

    }catch(err){
        res.status(400).send(err);
    };
})

app.listen(port , () => {
    console.log(`App started at port ${port}`);
});